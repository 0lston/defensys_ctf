# Use a base image with necessary tools
FROM ubuntu:latest

# Set working directory
WORKDIR /app

# Copy the C source file and flag file into the container
COPY ret2victory.c flag.txt ./

# Set file permissions for flag.txt
RUN chmod 400 flag.txt

# Install necessary packages
RUN apt-get update && apt-get install -y gcc socat
RUN useradd ctf

# Compile the C program
RUN gcc ret2victory.c -no-pie -fno-stack-protector -o ret2victory

# Expose port 8000 using socat
EXPOSE 8000
USER ctf
CMD socat TCP-LISTEN:8000,reuseaddr,fork EXEC:"./ret2victory"

#sudo docker build -t ret2victory
#sudo docker run -d -p 8000:8000 ret2victory
# Use a base image with necessary tools
FROM ubuntu:latest

# Set working directory
WORKDIR /app

# Copy the C source file and flag file into the container
COPY shell.c flag.txt ./

# Set file permissions for flag.txt
RUN chmod 400 flag.txt

# Install necessary packages
RUN apt-get update && apt-get install -y gcc socat
RUN useradd ctf

# Compile the C program
RUN gcc shell.c -no-pie -fno-stack-protector -z execstack -o shell

# Expose port 1000 using socat
EXPOSE 1000
USER ctf
CMD socat TCP-LISTEN:1000,reuseaddr,fork EXEC:"./shell"

#sudo docker build -t shell
#sudo docker run -d -p 1000:1000 shell
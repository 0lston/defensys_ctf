# Use a base image with necessary tools
FROM ubuntu:latest

# Set working directory
WORKDIR /app

# Copy the C source file and flag file into the container
COPY stack_protect.c flag.txt ./

# Set file permissions for flag.txt
RUN chmod 400 flag.txt

# Install necessary packages
RUN apt-get update && apt-get install -y gcc socat gcc-multilib
RUN useradd ctf

# Compile the C program with stack protection enabled
RUN gcc -m32 stack_protect.c -o stack_protect -fstack-protector -no-pie

# Expose port 9222 using socat
EXPOSE 9222
USER ctf
CMD socat TCP-LISTEN:9222,reuseaddr,fork EXEC:"./stack_protect"

#sudo docker build -t stack_protect .
#sudo docker run -d -p 9222:9222 stack_protect
